
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulating a multi compartment OLM neuron &#8212; NeuroML Documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/zcustom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interactive multi-compartment OLM cell example" href="NML2_examples/OLM.html" />
    <link rel="prev" title="Interactive single compartment HH example" href="NML2_examples/HH_single_compartment.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NeuroML Documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  User documentation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="MissionAndAims.html">
   Mission and Aims
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Usage.html">
   How to use this documentation
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="GettingStarted.html">
   Getting started with NeuroML
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="SingleNeuronExample.html">
     Simulating a regular spiking Izhikevich neuron
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NML2_examples/SingleNeuron.html">
     Interactive single Izhikevich neuron NeuroML example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="IzhikevichNetworkExample.html">
     A two population network of regular spiking Izhikevich neurons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NML2_examples/IzhikevichNetwork.html">
     Interactive two population network example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="SingleCompartmentHHExample.html">
     Simulating a single compartment Hodgkin-Huxley neuron
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NML2_examples/HH_single_compartment.html">
     Interactive single compartment HH example
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Simulating a multi compartment OLM neuron
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NML2_examples/OLM.html">
     Interactive multi-compartment OLM cell example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="FindingNeuroMLModels.html">
   Finding and sharing NeuroML models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CreatingNeuroMLModels.html">
   Creating NeuroML models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ValidatingNeuroMLModels.html">
   Validating NeuroML Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="VisualisingNeuroMLModels.html">
   Visualising NeuroML Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SimulatingNeuroMLModels.html">
   Simulating NeuroML Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="OptimisingNeuroMLModels.html">
   Optimising/fitting NeuroML Models
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Specification.html">
   Schema/Specification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="NeuroMLv2.html">
     NeuroML v2
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/NeuroMLCoreDimensions.html">
       NeuroMLCoreDimensions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/NeuroMLCoreCompTypes.html">
       NeuroMLCoreCompTypes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/Cells.html">
       Cells
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/Channels.html">
       Channels
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/Synapses.html">
       Synapses
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/Inputs.html">
       Inputs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/Networks.html">
       Networks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/PyNN.html">
       PyNN
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Schemas/Simulation.html">
       Simulation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NeuroMLv1.html">
     NeuroML v1
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="UsingNeuroMLv2AndLEMS.html">
   Using NeuroML 2 and LEMS
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Conventions.html">
     Conventions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="UnitsAndDimensions.html">
     Units and dimensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Paths.html">
     Paths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="QuantitiesAndRecording.html">
     Quantities and recording
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="LEMSSimulation.html">
     LEMS Simulation files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ExtendingNeuroMLv2WithLEMS.html">
     Extending NeuroML with LEMS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Software/Software.html">
   Software and Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/pyNeuroML.html">
     pyNeuroML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/libNeuroML.html">
     libNeuroML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/pyLEMS.html">
     pyLEMS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/NeuroMLlite.html">
     NeuroMLlite
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/jNeuroML.html">
     jNeuroML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/jLEMS.html">
     jLEMS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/NeuroML_API.html">
     NeuroML C++ API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/MatLab.html">
     MatLab NeuroML Toolbox
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Software/SupportingTools.html">
     Tools and resources with NeuroML support
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Publications.html">
   Citing NeuroML and related publications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="FAQ.html">
   Frequently asked questions (FAQ)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NeuroML events
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Events/202109-COMBINE.html">
   October 2021: NeuroML development workshop at COMBINE meeting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Events/202108-INCF-Training-Week.html">
   August 2021: NeuroML tutorial at INCF Training Weeks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Events/202107-CNS2021.html">
   July 2021: NeuroML tutorial at CNS*2021
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Events/202103-Harmony.html">
   March 2021: NeuroML hackathon at HARMONY 2021
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Events/PastEvents.html">
   Past NeuroML Events
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The NeuroML Initiative
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../NeuroMLOrg/CommunicationChannels.html">
   Getting in touch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NeuroMLOrg/Standards.html">
   Overview of standards in neuroscience
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NeuroMLOrg/History.html">
   A brief history of NeuroML
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../NeuroMLOrg/Board.html">
   NeuroML Editorial Board
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../NeuroMLOrg/BoardHistory.html">
     History of the NeuroML Editorial Board
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NeuroMLOrg/BoardMeetingReports.html">
     Workshop and Meeting reports
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NeuroMLOrg/ScientificCommittee.html">
   NeuroML Scientific Committee
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NeuroMLOrg/Funding.html">
   Funding and Acknowledgements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NeuroMLOrg/Contributors.html">
   NeuroML contributors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NeuroMLOrg/CoC.html">
   Code of Conduct
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Developer documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Devdocs/Devdocs.html">
   Overview
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Devdocs/DevSOP.html">
     Contribution guidelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Devdocs/ReleaseProcess.html">
     Release Process
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Devdocs/UpdatingStandard.html">
     Making changes to the NeuroML standard
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Devdocs/InteractionOtherBits.html">
   Interaction with other languages and standards
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Reference/Glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Reference/zBibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Userdocs/MultiCompartmentOLMexample.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/NeuroML/Documentation"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/NeuroML/Documentation/issues/new?title=Issue%20on%20page%20%2FUserdocs/MultiCompartmentOLMexample.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/NeuroML/Documentation/edit/master/source/Userdocs/MultiCompartmentOLMexample.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#declaring-the-model-in-neuroml">
   Declaring the model in NeuroML
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#declaring-the-cell">
     Declaring the cell
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#declaring-the-network">
     Declaring the network
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-generated-neuroml-model">
     The generated NeuroML model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulating-the-model">
   Simulating the model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-recorded-variables">
   Plotting the recorded variables
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Simulating a multi compartment OLM neuron</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#declaring-the-model-in-neuroml">
   Declaring the model in NeuroML
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#declaring-the-cell">
     Declaring the cell
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#declaring-the-network">
     Declaring the network
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-generated-neuroml-model">
     The generated NeuroML model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulating-the-model">
   Simulating the model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-recorded-variables">
   Plotting the recorded variables
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="simulating-a-multi-compartment-olm-neuron">
<span id="userdocs-getting-started-multi-compartment-example"></span><h1>Simulating a multi compartment OLM neuron<a class="headerlink" href="#simulating-a-multi-compartment-olm-neuron" title="Permalink to this headline">¶</a></h1>
<p>In this section we will model and simulate a multi-compartment Oriens-lacunosum moleculare (OLM) interneuron cell from the rodent hippocampal CA1 network model developed by Bezaire et al. (<span id="id1">[<a class="reference internal" href="../Reference/zBibliography.html#id15">BRB+16</a>]</span>).
The complete network model can be seen <a class="reference external" href="https://github.com/mbezaire/ca1">here on GitHub</a>, and <a class="reference external" href="https://www.opensourcebrain.org/projects/nc_ca1">here on Open Source Brain</a>.</p>
<div class="figure align-center" id="id2">
<img alt="Membrane potential for neuron recorded from the simulation at the soma" src="../_images/olm_example_sim_seg0_soma0-v.png" />
<p class="caption"><span class="caption-number">Fig. 22 </span><span class="caption-text">Membrane potential of the simulated OLM cell at the soma.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>This plot, saved as <code class="docutils literal notranslate"><span class="pre">olm_example_sim_seg0_soma0-v.png</span></code> is generated using the following Python NeuroML script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Multi-compartmental OLM cell example</span>

<span class="sd">File: olm-example.py</span>

<span class="sd">Copyright 2021 NeuroML contributors</span>
<span class="sd">Authors: Padraig Gleeson, Ankur Sinha</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">neuroml</span> <span class="kn">import</span> <span class="p">(</span><span class="n">NeuroMLDocument</span><span class="p">,</span> <span class="n">IncludeType</span><span class="p">,</span> <span class="n">Population</span><span class="p">,</span> <span class="n">PulseGenerator</span><span class="p">,</span> <span class="n">ExplicitInput</span><span class="p">,</span> <span class="n">Network</span><span class="p">,</span> <span class="n">SegmentGroup</span><span class="p">,</span> <span class="n">Member</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Include</span><span class="p">,</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">Location</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">CellBuilder</span> <span class="kn">import</span> <span class="p">(</span><span class="n">create_cell</span><span class="p">,</span> <span class="n">add_segment</span><span class="p">,</span> <span class="n">add_channel_density</span><span class="p">,</span> <span class="n">set_init_memb_potential</span><span class="p">,</span> <span class="n">set_resistivity</span><span class="p">,</span> <span class="n">set_specific_capacitance</span><span class="p">,</span> <span class="n">get_seg_group_by_id</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyneuroml</span> <span class="kn">import</span> <span class="n">pynml</span>
<span class="kn">from</span> <span class="nn">pyneuroml.lems</span> <span class="kn">import</span> <span class="n">LEMSSimulation</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Main function</span>

<span class="sd">    Include the NeuroML model into a LEMS simulation file, run it, plot some</span>
<span class="sd">    data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Simulation bits</span>
    <span class="n">sim_id</span> <span class="o">=</span> <span class="s2">&quot;olm_example_sim&quot;</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">LEMSSimulation</span><span class="p">(</span><span class="n">sim_id</span><span class="o">=</span><span class="n">sim_id</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">simulation_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
    <span class="c1"># Include the NeuroML model file</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">include_neuroml2_file</span><span class="p">(</span><span class="n">create_olm_network</span><span class="p">())</span>
    <span class="c1"># Assign target for the simulation</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">assign_simulation_target</span><span class="p">(</span><span class="s2">&quot;single_olm_cell_network&quot;</span><span class="p">)</span>

    <span class="c1"># Recording information from the simulation</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">create_output_file</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span> <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0[0]/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_soma_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/0/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_soma_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/1/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_axon_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/2/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_axon_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/3/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_dend_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/4/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_dend_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/6/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_dend_1&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/5/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_dend_1&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/7/v&quot;</span><span class="p">)</span>
    <span class="c1"># Save LEMS simulation to file</span>
    <span class="n">sim_file</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">()</span>

    <span class="c1"># Run the simulation using the NEURON simulator</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">run_lems_with_jneuroml_neuron</span><span class="p">(</span><span class="n">sim_file</span><span class="p">,</span> <span class="n">max_memory</span><span class="o">=</span><span class="s2">&quot;2G&quot;</span><span class="p">,</span> <span class="n">nogui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Plot the data</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">sim_id</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">sim_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the sim data.</span>

<span class="sd">    Load the data from the file and plot the graph for the membrane potential</span>
<span class="sd">    using the pynml generate_plot utility function.</span>

<span class="sd">    :sim_id: ID of simulaton</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (soma seg 0)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg0_soma0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (soma seg 1)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg1_soma0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (axon seg 0)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg0_axon0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (axon seg 1)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg1_axon0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">create_olm_network</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create the network</span>

<span class="sd">    :returns: name of network nml file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">net_doc</span> <span class="o">=</span> <span class="n">NeuroMLDocument</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;network&quot;</span><span class="p">,</span>
                              <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;OLM cell network&quot;</span><span class="p">)</span>
    <span class="n">net_doc_fn</span> <span class="o">=</span> <span class="s2">&quot;olm_example_net.nml&quot;</span>
    <span class="n">net_doc</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IncludeType</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="n">create_olm_cell</span><span class="p">()))</span>
    <span class="c1"># Create a population: convenient to create many cells of the same type</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;pop0&quot;</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;A population for our cell&quot;</span><span class="p">,</span>
                     <span class="n">component</span><span class="o">=</span><span class="s2">&quot;olm&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;populationList&quot;</span><span class="p">)</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Instance</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">Location</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)))</span>
    <span class="c1"># Input</span>
    <span class="n">pulsegen</span> <span class="o">=</span> <span class="n">PulseGenerator</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;pg_olm&quot;</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Simple pulse generator&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="s2">&quot;100ms&quot;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="s2">&quot;100ms&quot;</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="s2">&quot;0.08nA&quot;</span><span class="p">)</span>

    <span class="n">exp_input</span> <span class="o">=</span> <span class="n">ExplicitInput</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;pop0[0]&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;pg_olm&quot;</span><span class="p">)</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;single_olm_cell_network&quot;</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;A network with a single population&quot;</span><span class="p">)</span>
    <span class="n">net_doc</span><span class="o">.</span><span class="n">pulse_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pulsegen</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">explicit_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp_input</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
    <span class="n">net_doc</span><span class="o">.</span><span class="n">networks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>

    <span class="n">pynml</span><span class="o">.</span><span class="n">write_neuroml2_file</span><span class="p">(</span><span class="n">nml2_doc</span><span class="o">=</span><span class="n">net_doc</span><span class="p">,</span> <span class="n">nml2_file_name</span><span class="o">=</span><span class="n">net_doc_fn</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">net_doc_fn</span>


<span class="k">def</span> <span class="nf">create_olm_cell</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create the complete cell.</span>

<span class="sd">    :returns: cell object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nml_cell_doc</span> <span class="o">=</span> <span class="n">NeuroMLDocument</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;oml_cell&quot;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">create_cell</span><span class="p">(</span><span class="s2">&quot;olm&quot;</span><span class="p">)</span>
    <span class="n">nml_cell_file</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;.cell.nml&quot;</span>

    <span class="c1"># Add two soma segments</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">soma_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_soma_0&quot;</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">)</span>

    <span class="n">soma_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.</span> <span class="o">+</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_soma_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">soma_0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">)</span>

    <span class="c1"># Add axon segments</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">axon_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_axon_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">soma_0</span><span class="p">,</span>
                         <span class="n">fraction_along</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">)</span>
    <span class="n">axon_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_axon_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">axon_0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">)</span>

    <span class="c1"># Add 2 dendrite segments</span>

    <span class="n">diam</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="n">dend_0_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_dend_0&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">soma_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">)</span>

    <span class="n">dend_1_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mi">177</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_dend_0&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">dend_0_0</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">)</span>

    <span class="n">dend_0_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_dend_1&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">soma_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">)</span>
    <span class="n">dend_1_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">177</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_dend_1&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">dend_0_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">)</span>

    <span class="c1"># XXX: For segment groups to be correctly mapped to sections in NEURON,</span>
    <span class="c1"># they must include the correct neurolex ID</span>
    <span class="k">for</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;soma_0&quot;</span><span class="p">,</span> <span class="s2">&quot;axon_0&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_0&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_1&quot;</span><span class="p">]:</span>
        <span class="n">section_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="n">section_name</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="n">section_group</span><span class="o">.</span><span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="s1">&#39;sao864921383&#39;</span>

    <span class="n">den_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">))</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">))</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0.8 0 0&quot;</span><span class="p">))</span>

    <span class="n">ax_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;axon_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">ax_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">))</span>
    <span class="n">ax_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0 0.8 0&quot;</span><span class="p">))</span>

    <span class="n">soma_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;soma_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">soma_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">))</span>

    <span class="n">soma_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0 0 0.8&quot;</span><span class="p">))</span>

    <span class="c1"># Other cell properties</span>
    <span class="n">set_init_memb_potential</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;-67mV&quot;</span><span class="p">)</span>
    <span class="n">set_resistivity</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;0.15 kohm_cm&quot;</span><span class="p">)</span>
    <span class="n">set_specific_capacitance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;1.3 uF_per_cm2&quot;</span><span class="p">)</span>

    <span class="c1"># channels</span>
    <span class="c1"># leak</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;leak_all&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;0.01 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;leak_chan&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/leak_chan.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-67mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;non_specific&quot;</span><span class="p">)</span>
    <span class="c1"># HCNolm_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;HCNolm_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;0.5 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;HCNolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/HCNolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-32.9mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;73.37 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;105.8 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_axon</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_axon&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;117.392 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_group&quot;</span><span class="p">)</span>
    <span class="c1"># KvAolm_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;KvAolm_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;4.95 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;KvAolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/KvAolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># KvAolm_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;KvAolm_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;2.8 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;KvAolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/KvAolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;10.7 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;23.4 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_axon</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_axon&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;17.12 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_group&quot;</span><span class="p">)</span>

    <span class="n">nml_cell_doc</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">write_neuroml2_file</span><span class="p">(</span><span class="n">nml_cell_doc</span><span class="p">,</span> <span class="n">nml_cell_file</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nml_cell_file</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>As we will see, we repeat the same operations in the script while adding segments and ion-channels to our model, so we also write some helper functions to make it easier for ourselves:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Utility functions to help build cells in NeuroML</span>

<span class="sd">File: CellBuilder.py</span>

<span class="sd">Copyright 2021 NeuroML contributors</span>
<span class="sd">Author: Ankur Sinha &lt;sanjay DOT ankur AT gmail DOT com&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">neuroml</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Cell</span><span class="p">,</span> <span class="n">Morphology</span><span class="p">,</span> <span class="n">MembraneProperties</span><span class="p">,</span> <span class="n">IntracellularProperties</span><span class="p">,</span> <span class="n">BiophysicalProperties</span><span class="p">,</span> <span class="n">Segment</span><span class="p">,</span> <span class="n">SegmentGroup</span><span class="p">,</span> <span class="n">Point3DWithDiam</span><span class="p">,</span> <span class="n">SegmentParent</span><span class="p">,</span> <span class="n">Member</span><span class="p">,</span> <span class="n">InitMembPotential</span><span class="p">,</span> <span class="n">Resistivity</span><span class="p">,</span> <span class="n">SpecificCapacitance</span><span class="p">,</span> <span class="n">NeuroMLDocument</span><span class="p">,</span> <span class="n">IncludeType</span><span class="p">,</span> <span class="n">ChannelDensity</span><span class="p">)</span> <span class="c1"># type: ignore  # noqa</span>
<span class="kn">from</span> <span class="nn">pyneuroml.pynml</span> <span class="kn">import</span> <span class="n">print_function</span>  <span class="c1"># type: ignore</span>


<span class="n">neuro_lex_ids</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;axon&#39;</span><span class="p">:</span> <span class="s2">&quot;GO:0030424&quot;</span><span class="p">,</span>
    <span class="s1">&#39;dend&#39;</span><span class="p">:</span> <span class="s2">&quot;GO:0030425&quot;</span><span class="p">,</span>
    <span class="s1">&#39;soma&#39;</span><span class="p">:</span> <span class="s2">&quot;GO:0043025&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">create_cell</span><span class="p">(</span><span class="n">cell_id</span><span class="p">):</span>
    <span class="c1"># type: (str) -&gt; Cell</span>
    <span class="sd">&quot;&quot;&quot;Create a NeuroML Cell.</span>

<span class="sd">    Initialises the cell with these properties assigning IDs where applicable:</span>
<span class="sd">    - Morphology: &quot;morphology&quot;</span>
<span class="sd">    - BiophysicalProperties: &quot;biophys&quot;</span>
<span class="sd">    - MembraneProperties</span>
<span class="sd">    - IntracellularProperties</span>
<span class="sd">    - SegmentGroups: &quot;all&quot;, &quot;soma_group&quot;, &quot;dendrite_group&quot;, &quot;axon_group&quot; which</span>
<span class="sd">      can be used to include all, soma, dendrite, and axon segments</span>
<span class="sd">      respectively.</span>

<span class="sd">    Note that since this cell does not currently include a segment in its</span>
<span class="sd">    morphology, it is *not* a valid NeuroML construct. Use the `add_segment`</span>
<span class="sd">    function to add segments. `add_segment` will also populate the default</span>
<span class="sd">    segment groups this creates.</span>

<span class="sd">    :param cell_id: id of the cell</span>
<span class="sd">    :type cell_id: str</span>
<span class="sd">    :returns: created cell object of type neuroml.Cell</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">cell_id</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span> <span class="o">=</span> <span class="n">Morphology</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;morphology&#39;</span><span class="p">)</span>
    <span class="n">membrane_properties</span> <span class="o">=</span> <span class="n">MembraneProperties</span><span class="p">()</span>
    <span class="n">intracellular_properties</span> <span class="o">=</span> <span class="n">IntracellularProperties</span><span class="p">()</span>

    <span class="n">cell</span><span class="o">.</span><span class="n">biophysical_properties</span> <span class="o">=</span> <span class="n">BiophysicalProperties</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;biophys&quot;</span><span class="p">,</span> <span class="n">intracellular_properties</span><span class="o">=</span><span class="n">intracellular_properties</span><span class="p">,</span>
        <span class="n">membrane_properties</span><span class="o">=</span><span class="n">membrane_properties</span><span class="p">)</span>

    <span class="n">seg_group_all</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">seg_group_soma</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;soma_group&#39;</span><span class="p">,</span>
                                  <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">],</span>
                                  <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Default soma segment group for the cell&quot;</span><span class="p">)</span>
    <span class="n">seg_group_axon</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;axon_group&#39;</span><span class="p">,</span>
                                  <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;axon&quot;</span><span class="p">],</span>
                                  <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Default axon segment group for the cell&quot;</span><span class="p">)</span>
    <span class="n">seg_group_dend</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;dendrite_group&#39;</span><span class="p">,</span>
                                  <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;dend&quot;</span><span class="p">],</span>
                                  <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Default dendrite segment group for the cell&quot;</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_all</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_soma</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_axon</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_dend</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cell</span>


<span class="k">def</span> <span class="nf">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">prox</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction_along</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># type: (Cell, List[float], List[float], str, SegmentParent, float, SegmentGroup) -&gt; Segment</span>
    <span class="sd">&quot;&quot;&quot;Add a segment to the cell.</span>

<span class="sd">    Convention: use axon_, soma_, dend_ prefixes for axon, soma, and dendrite</span>
<span class="sd">    segments respectivey. This will allow this function to add the correct</span>
<span class="sd">    neurolex IDs to the group.</span>

<span class="sd">    The created segment is also added to the default segment groups that were</span>
<span class="sd">    created by the `create_cell` function: &quot;all&quot;, &quot;dendrite_group&quot;,</span>
<span class="sd">    &quot;soma_group&quot;, &quot;axon_group&quot; if the convention is followed.</span>

<span class="sd">    :param cell: cell to add segment to</span>
<span class="sd">    :type cell: Cell</span>
<span class="sd">    :param prox: proximal segment information</span>
<span class="sd">    :type prox: list with 4 float entries: [x, y, z, diameter]</span>
<span class="sd">    :param dist: dist segment information</span>
<span class="sd">    :type dist: list with 4 float entries: [x, y, z, diameter]</span>
<span class="sd">    :param name: name of segment</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param parent: parent segment</span>
<span class="sd">    :type parent: SegmentParent</span>
<span class="sd">    :param fraction_along: where the new segment is connected to the parent (0: distal point, 1: proximal point)</span>
<span class="sd">    :type fraction_along: float</span>
<span class="sd">    :param group: segment group to add the segment to</span>
<span class="sd">    :type group: SegmentGroup</span>
<span class="sd">    :returns: the created segment</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prox</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Point3DWithDiam</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">diameter</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">print_function</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: prox must be a list of 4 elements&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Point3DWithDiam</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">diameter</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">print_function</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: dist must be a list of 4 elements&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="n">segid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segments</span><span class="p">)</span>

    <span class="n">sp</span> <span class="o">=</span> <span class="n">SegmentParent</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">fraction_along</span><span class="o">=</span><span class="n">fraction_along</span><span class="p">)</span> <span class="k">if</span> <span class="n">parent</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">segid</span><span class="p">,</span> <span class="n">proximal</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">distal</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">if</span> <span class="n">group</span><span class="p">:</span>
        <span class="n">seg_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="n">seg_group_all</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="n">seg_group_default</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;axon_&quot;</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;axon&quot;</span><span class="p">]</span>  <span class="c1"># See http://amigo.geneontology.org/amigo/term/GO:0030424</span>
            <span class="n">seg_group_default</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;axon_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;soma_&quot;</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span>
            <span class="n">seg_group_default</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;soma_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;dend_&quot;</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;dend&quot;</span><span class="p">]</span>
            <span class="n">seg_group_default</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">seg_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seg_group</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_id</span><span class="p">)</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group</span><span class="p">)</span>

        <span class="n">seg_group</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Member</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="c1"># Ideally, these higher level segment groups should just include other</span>
        <span class="c1"># segment groups using Include, which would result in smaller NML</span>
        <span class="c1"># files. However, because these default segment groups are defined</span>
        <span class="c1"># first, they are printed in the NML file before the new segments and their</span>
        <span class="c1"># groups. The jnml validator does not like this.</span>
        <span class="c1"># TODO: clarify if the order of definition is important, or if the jnml</span>
        <span class="c1"># validator needs to be updated to manage this use case.</span>
        <span class="k">if</span> <span class="n">seg_group_default</span><span class="p">:</span>
            <span class="n">seg_group_default</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Member</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="n">seg_group_all</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Member</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">segment</span>


<span class="k">def</span> <span class="nf">set_init_memb_potential</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
    <span class="c1"># type: (Cell, str, str) -&gt; None</span>
    <span class="sd">&quot;&quot;&quot;Set the initial membrane potential of the cell.</span>

<span class="sd">    :param cell: cell to modify</span>
<span class="sd">    :type cell: Cell</span>
<span class="sd">    :param v: value to set for membrane potential with units</span>
<span class="sd">    :type v: str</span>
<span class="sd">    :param group: id of segment group to modify</span>
<span class="sd">    :type group: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">biophysical_properties</span><span class="o">.</span><span class="n">membrane_properties</span><span class="o">.</span><span class="n">init_memb_potentials</span> <span class="o">=</span> \
        <span class="p">[</span><span class="n">InitMembPotential</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">segment_groups</span><span class="o">=</span><span class="n">group</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">set_resistivity</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">resistivity</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
    <span class="c1"># type: (Cell, str, str) -&gt; None</span>
    <span class="sd">&quot;&quot;&quot;Set the resistivity of the cell</span>

<span class="sd">    :param cell: cell to modfify</span>
<span class="sd">    :param resistivity: value resistivity to set with units</span>
<span class="sd">    :type resistivity: str</span>
<span class="sd">    :param group: segment group to modify</span>
<span class="sd">    :type group: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">biophysical_properties</span><span class="o">.</span><span class="n">intracellular_properties</span><span class="o">.</span><span class="n">resistivities</span> <span class="o">=</span> <span class="p">[</span><span class="n">Resistivity</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">resistivity</span><span class="p">,</span> <span class="n">segment_groups</span><span class="o">=</span><span class="n">group</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">set_specific_capacitance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">spec_cap</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
    <span class="c1"># type: (Cell, str, str) -&gt; None</span>
    <span class="sd">&quot;&quot;&quot;Set the specific capacitance for the cell.</span>

<span class="sd">    :param cell: cell to set specific capacitance for</span>
<span class="sd">    :type cell: Cell</span>
<span class="sd">    :param spec_cap: value of specific capacitance with units</span>
<span class="sd">    :type spec_cap: str</span>
<span class="sd">    :param group: segment group to modify</span>
<span class="sd">    :type group: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">biophysical_properties</span><span class="o">.</span><span class="n">membrane_properties</span><span class="o">.</span><span class="n">specific_capacitances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpecificCapacitance</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">spec_cap</span><span class="p">,</span> <span class="n">segment_groups</span><span class="o">=</span><span class="n">group</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span> <span class="n">cd_id</span><span class="p">,</span> <span class="n">cond_density</span><span class="p">,</span> <span class="n">ion_channel</span><span class="p">,</span> <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;0.0 mV&quot;</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;non_specific&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
    <span class="c1"># type: (Cell, NeuroMLDocument, str, str, str, str, str, str, str) -&gt; None</span>
    <span class="sd">&quot;&quot;&quot;Add channel density.</span>

<span class="sd">    :param cell: cell to be modified</span>
<span class="sd">    :type cell: Cell</span>
<span class="sd">    :param nml_cell_doc: cell NeuroML document to which channel density is to be added</span>
<span class="sd">    :type nml_cell_doc: NeuroMLDocument</span>
<span class="sd">    :param cd_id: id for channel density</span>
<span class="sd">    :type cd_id: str</span>
<span class="sd">    :param cond_density: value of conductance density with units</span>
<span class="sd">    :type cond_density: str</span>
<span class="sd">    :param ion_channel: name of ion channel</span>
<span class="sd">    :type ion_channel: str</span>
<span class="sd">    :param ion_chan_def_file: path to NeuroML2 file defining the ion channel, if empty, it assumes the channel is defined in the same file</span>
<span class="sd">    :type ion_chan_def_file: str</span>
<span class="sd">    :param erev: value of reversal potential with units</span>
<span class="sd">    :type erev: str</span>
<span class="sd">    :param ion: name of ion</span>
<span class="sd">    :type ion: str</span>
<span class="sd">    :param group: segment groups to add to</span>
<span class="sd">    :type group: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">ChannelDensity</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">cd_id</span><span class="p">,</span>
                        <span class="n">segment_groups</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="n">ion</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="n">ion_channel</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="n">erev</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="n">cond_density</span><span class="p">)</span>

    <span class="n">cell</span><span class="o">.</span><span class="n">biophysical_properties</span><span class="o">.</span><span class="n">membrane_properties</span><span class="o">.</span><span class="n">channel_densities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ion_chan_def_file</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">IncludeType</span><span class="p">(</span><span class="n">ion_chan_def_file</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nml_cell_doc</span><span class="o">.</span><span class="n">includes</span><span class="p">:</span>
            <span class="n">nml_cell_doc</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IncludeType</span><span class="p">(</span><span class="n">ion_chan_def_file</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_seg_group_by_id</span><span class="p">(</span><span class="n">sg_id</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
    <span class="c1"># type (str, Cell) -&gt; SegmentGroup</span>
    <span class="sd">&quot;&quot;&quot;Return the SegmentGroup object for the specified segment group id.</span>

<span class="sd">    :param sg_id: id of segment group to find</span>
<span class="sd">    :type sg_id: str</span>
<span class="sd">    :param cell: cell to look for segment group in</span>
<span class="sd">    :type cell: Cell</span>
<span class="sd">    :returns: SegmentGroup object of specified ID or None if not found</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sg_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cell</span><span class="p">:</span>
        <span class="n">print_function</span><span class="p">(</span><span class="s2">&quot;Please specify both a segment group id and a Cell&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sg</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">sg_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sg</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">get_seg_group_by_id_substring</span><span class="p">(</span><span class="n">sg_id_substring</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
    <span class="c1"># type (str, Cell) -&gt; list</span>
    <span class="sd">&quot;&quot;&quot;Return segment groups that include the specified substring.</span>

<span class="sd">    :param sg_id_substring: substring to match</span>
<span class="sd">    :type sg_id_substring: str</span>
<span class="sd">    :param cell: cell to look for segment group in</span>
<span class="sd">    :type cell: Cell</span>
<span class="sd">    :returns: list of SegmentGroups whose IDs include the given substring</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sg_group_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sg_id_substring</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cell</span><span class="p">:</span>
        <span class="n">print_function</span><span class="p">(</span><span class="s2">&quot;Please specify both a segment group id and a Cell&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sg_id_substring</span> <span class="ow">in</span> <span class="n">sg</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="n">sg_group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sg_group_list</span>
</pre></div>
</div>
<p>These helper functions will be included in the Python NeuroML libraries in their next release.
Currently, we <em>import</em> them into our Python script at the top:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CellBuilder</span> <span class="kn">import</span> <span class="p">(</span><span class="n">create_cell</span><span class="p">,</span> <span class="n">add_segment</span><span class="p">,</span> <span class="n">add_channel_density</span><span class="p">,</span> <span class="n">set_init_memb_potential</span><span class="p">,</span> <span class="n">set_resistivity</span><span class="p">,</span> <span class="n">set_specific_capacitance</span><span class="p">,</span> <span class="n">get_seg_group_by_id</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="declaring-the-model-in-neuroml">
<h2>Declaring the model in NeuroML<a class="headerlink" href="#declaring-the-model-in-neuroml" title="Permalink to this headline">¶</a></h2>
<p>Similar to previous examples, we will first declare the model, visualise it, and then simulate it.
The OLM model is slightly more complex than the HH neuron model we had worked with in the <a class="reference internal" href="SingleCompartmentHHExample.html#userdocs-getting-started-single-compartment-example"><span class="std std-ref">previous tutorial</span></a> since it includes multiple compartments.
However, where we had declared the ion-channels ourselves in the previous example, here will will not do so.
We will <em>include</em> channels that have been pre-defined in NeuroML to demonstrate how components defined in NeuroML can be easily re-used in models.</p>
<p>We will follow the same method as before.
We will first define the cell, create a network with one instance of the cell, and then simulate it to record and plot the membrane potential from different segments.</p>
<div class="section" id="declaring-the-cell">
<h3>Declaring the cell<a class="headerlink" href="#declaring-the-cell" title="Permalink to this headline">¶</a></h3>
<p>To keep our Python script modularised, we start constructing our <a class="reference internal" href="Schemas/Cells.html#schema-cell"><span class="std std-ref">cell</span></a> in a separate function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_olm_cell</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create the complete cell.</span>

<span class="sd">    :returns: cell object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nml_cell_doc</span> <span class="o">=</span> <span class="n">NeuroMLDocument</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;oml_cell&quot;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">create_cell</span><span class="p">(</span><span class="s2">&quot;olm&quot;</span><span class="p">)</span>
    <span class="n">nml_cell_file</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;.cell.nml&quot;</span>

    <span class="c1"># Add two soma segments</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">soma_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_soma_0&quot;</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">)</span>

    <span class="n">soma_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.</span> <span class="o">+</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_soma_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">soma_0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">)</span>

    <span class="c1"># Add axon segments</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">axon_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_axon_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">soma_0</span><span class="p">,</span>
                         <span class="n">fraction_along</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">)</span>
    <span class="n">axon_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_axon_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">axon_0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">)</span>

    <span class="c1"># Add 2 dendrite segments</span>

    <span class="n">diam</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="n">dend_0_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_dend_0&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">soma_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">)</span>

    <span class="n">dend_1_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mi">177</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_dend_0&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">dend_0_0</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">)</span>

    <span class="n">dend_0_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_dend_1&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">soma_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">)</span>
    <span class="n">dend_1_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">177</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_dend_1&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">dend_0_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">)</span>

    <span class="c1"># XXX: For segment groups to be correctly mapped to sections in NEURON,</span>
    <span class="c1"># they must include the correct neurolex ID</span>
    <span class="k">for</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;soma_0&quot;</span><span class="p">,</span> <span class="s2">&quot;axon_0&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_0&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_1&quot;</span><span class="p">]:</span>
        <span class="n">section_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="n">section_name</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="n">section_group</span><span class="o">.</span><span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="s1">&#39;sao864921383&#39;</span>

    <span class="n">den_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">))</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">))</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0.8 0 0&quot;</span><span class="p">))</span>

    <span class="n">ax_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;axon_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">ax_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">))</span>
    <span class="n">ax_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0 0.8 0&quot;</span><span class="p">))</span>

    <span class="n">soma_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;soma_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">soma_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">))</span>

    <span class="n">soma_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0 0 0.8&quot;</span><span class="p">))</span>

    <span class="c1"># Other cell properties</span>
    <span class="n">set_init_memb_potential</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;-67mV&quot;</span><span class="p">)</span>
    <span class="n">set_resistivity</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;0.15 kohm_cm&quot;</span><span class="p">)</span>
    <span class="n">set_specific_capacitance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;1.3 uF_per_cm2&quot;</span><span class="p">)</span>

    <span class="c1"># channels</span>
    <span class="c1"># leak</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;leak_all&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;0.01 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;leak_chan&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/leak_chan.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-67mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;non_specific&quot;</span><span class="p">)</span>
    <span class="c1"># HCNolm_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;HCNolm_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;0.5 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;HCNolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/HCNolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-32.9mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;73.37 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;105.8 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_axon</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_axon&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;117.392 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_group&quot;</span><span class="p">)</span>
    <span class="c1"># KvAolm_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;KvAolm_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;4.95 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;KvAolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/KvAolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># KvAolm_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;KvAolm_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;2.8 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;KvAolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/KvAolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;10.7 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;23.4 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_axon</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_axon&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;17.12 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_group&quot;</span><span class="p">)</span>

    <span class="n">nml_cell_doc</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">write_neuroml2_file</span><span class="p">(</span><span class="n">nml_cell_doc</span><span class="p">,</span> <span class="n">nml_cell_file</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nml_cell_file</span>

</pre></div>
</div>
<p>Let us walk through this function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">nml_cell_doc</span> <span class="o">=</span> <span class="n">NeuroMLDocument</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;oml_cell&quot;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">create_cell</span><span class="p">(</span><span class="s2">&quot;olm&quot;</span><span class="p">)</span>
    <span class="n">nml_cell_file</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;.cell.nml&quot;</span>
</pre></div>
</div>
<p>First, we create a new NeuroML document that we will use to save this cell.
Then, we proceed to create a new cell using the <a class="reference internal" href="Schemas/Cells.html#schema-cell"><span class="std std-ref">Cell NeuroML component type</span></a>, and define the name of the file we will use to store the cell in NeuroML.
To create the cell, we use the <code class="docutils literal notranslate"><span class="pre">create_cell</span></code> utility function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_cell</span><span class="p">(</span><span class="n">cell_id</span><span class="p">):</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">cell_id</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span> <span class="o">=</span> <span class="n">Morphology</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;morphology&#39;</span><span class="p">)</span>
    <span class="n">membrane_properties</span> <span class="o">=</span> <span class="n">MembraneProperties</span><span class="p">()</span>
    <span class="n">intracellular_properties</span> <span class="o">=</span> <span class="n">IntracellularProperties</span><span class="p">()</span>

    <span class="n">cell</span><span class="o">.</span><span class="n">biophysical_properties</span> <span class="o">=</span> <span class="n">BiophysicalProperties</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;biophys&quot;</span><span class="p">,</span> <span class="n">intracellular_properties</span><span class="o">=</span><span class="n">intracellular_properties</span><span class="p">,</span>
        <span class="n">membrane_properties</span><span class="o">=</span><span class="n">membrane_properties</span><span class="p">)</span>

    <span class="n">seg_group_all</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">seg_group_soma</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;soma_group&#39;</span><span class="p">,</span>
                                  <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">],</span>
                                  <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Default soma segment group for the cell&quot;</span><span class="p">)</span>
    <span class="n">seg_group_axon</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;axon_group&#39;</span><span class="p">,</span>
                                  <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;axon&quot;</span><span class="p">],</span>
                                  <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Default axon segment group for the cell&quot;</span><span class="p">)</span>
    <span class="n">seg_group_dend</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;dendrite_group&#39;</span><span class="p">,</span>
                                  <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;dend&quot;</span><span class="p">],</span>
                                  <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Default dendrite segment group for the cell&quot;</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_all</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_soma</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_axon</span><span class="p">)</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group_dend</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cell</span>

</pre></div>
</div>
<p>We now know that a <a class="reference internal" href="Schemas/Cells.html#schema-cell"><span class="std std-ref">Cell</span></a> component has two children: <a class="reference internal" href="Schemas/Cells.html#schema-morphology"><span class="std std-ref">morphology</span></a>, and <a class="reference internal" href="Schemas/Cells.html#schema-biophysicalproperties"><span class="std std-ref">biophysical properties</span></a>.
The function simply creates the new <a class="reference internal" href="Schemas/Cells.html#schema-cell"><span class="std std-ref">Cell</span></a> component for us and initialises the <a class="reference internal" href="Schemas/Cells.html#schema-morphology"><span class="std std-ref">morphology</span></a> and <a class="reference internal" href="Schemas/Cells.html#schema-biophysicalproperties"><span class="std std-ref">biophysical properties</span></a>.
Additionally, it creates some default <a class="reference internal" href="Schemas/Cells.html#schema-segmentgroup"><span class="std std-ref">segment groups</span></a> for us that we use to organise our our segments in later.</p>
<p>We now have an empty cell.
Since we are building a multi-compartmental cell, we now proceed to define the detailed morphology of the cell.
We do this by adding <a class="reference internal" href="Schemas/Cells.html#schema-segment"><span class="std std-ref">segments</span></a> and grouping them in to <a class="reference internal" href="Schemas/Cells.html#schema-segmentgroup"><span class="std std-ref">segment groups</span></a> which are both children elements of the <a class="reference internal" href="Schemas/Cells.html#schema-morphology"><span class="std std-ref">morphology</span></a> of the cell.
This is done using the <code class="docutils literal notranslate"><span class="pre">add_segment</span></code> utility function as required:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">soma_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_soma_0&quot;</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The utility function takes the dimensions of the segment—it’s <a class="reference internal" href="Schemas/Cells.html#schema-proximal"><span class="std std-ref">proximal</span></a> and <a class="reference internal" href="Schemas/Cells.html#schema-distal"><span class="std std-ref">distal</span></a> co-ordinates and the diameter to create a segment of the provided name.
Additionally, since segments need to be contiguous, it adds the segment to a <em>parent</em> segment.
Finally, it places the segment into the specified segment group and the default groups that we also have and adds the segment to the cell’s morphology.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">prox</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction_along</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prox</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Point3DWithDiam</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">diameter</span><span class="o">=</span><span class="n">prox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">print_function</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: prox must be a list of 4 elements&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Point3DWithDiam</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">diameter</span><span class="o">=</span><span class="n">dist</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">print_function</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: dist must be a list of 4 elements&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="n">segid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segments</span><span class="p">)</span>

    <span class="n">sp</span> <span class="o">=</span> <span class="n">SegmentParent</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">fraction_along</span><span class="o">=</span><span class="n">fraction_along</span><span class="p">)</span> <span class="k">if</span> <span class="n">parent</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">segid</span><span class="p">,</span> <span class="n">proximal</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">distal</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">if</span> <span class="n">group</span><span class="p">:</span>
        <span class="n">seg_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="n">seg_group_all</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="n">seg_group_default</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;axon_&quot;</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;axon&quot;</span><span class="p">]</span>  <span class="c1"># See http://amigo.geneontology.org/amigo/term/GO:0030424</span>
            <span class="n">seg_group_default</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;axon_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;soma_&quot;</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span>
            <span class="n">seg_group_default</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;soma_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;dend_&quot;</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="n">neuro_lex_ids</span><span class="p">[</span><span class="s2">&quot;dend&quot;</span><span class="p">]</span>
            <span class="n">seg_group_default</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">seg_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seg_group</span> <span class="o">=</span> <span class="n">SegmentGroup</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">neuro_lex_id</span><span class="o">=</span><span class="n">neuro_lex_id</span><span class="p">)</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segment_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_group</span><span class="p">)</span>

        <span class="n">seg_group</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Member</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">seg_group_default</span><span class="p">:</span>
            <span class="n">seg_group_default</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Member</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="n">seg_group_all</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Member</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">segment</span>
</pre></div>
</div>
<p>We call the same function multiple times to add soma, dendritic, and axonal segments to our cell.
Note how the segments connect to each other to form the contiguous cell morphology.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Add two soma segments</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">soma_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_soma_0&quot;</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">)</span>

    <span class="n">soma_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.</span> <span class="o">+</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_soma_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">soma_0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">)</span>

    <span class="c1"># Add axon segments</span>
    <span class="n">diam</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">axon_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_axon_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">soma_0</span><span class="p">,</span>
                         <span class="n">fraction_along</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">)</span>
    <span class="n">axon_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                         <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                         <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_axon_0&quot;</span><span class="p">,</span>
                         <span class="n">parent</span><span class="o">=</span><span class="n">axon_0</span><span class="p">,</span>
                         <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">)</span>

    <span class="c1"># Add 2 dendrite segments</span>

    <span class="n">diam</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="n">dend_0_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_dend_0&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">soma_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">)</span>

    <span class="n">dend_1_0</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="mi">177</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_dend_0&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">dend_0_0</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">)</span>

    <span class="n">dend_0_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg0_dend_1&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">soma_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">)</span>
    <span class="n">dend_1_1</span> <span class="o">=</span> <span class="n">add_segment</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span>
                           <span class="n">prox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dist</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">177</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam</span><span class="p">],</span>
                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seg1_dend_1&quot;</span><span class="p">,</span>
                           <span class="n">parent</span><span class="o">=</span><span class="n">dend_0_1</span><span class="p">,</span>
                           <span class="n">fraction_along</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we add extra information to our segments and organise them so that they can be correctly exported to the NEURON format for simulation later.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">for</span> <span class="n">section_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;soma_0&quot;</span><span class="p">,</span> <span class="s2">&quot;axon_0&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_0&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_1&quot;</span><span class="p">]:</span>
        <span class="n">section_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="n">section_name</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="n">section_group</span><span class="o">.</span><span class="n">neuro_lex_id</span> <span class="o">=</span> <span class="s1">&#39;sao864921383&#39;</span>

    <span class="n">den_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;dend_0&quot;</span><span class="p">))</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;dend_1&quot;</span><span class="p">))</span>
    <span class="n">den_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0.8 0 0&quot;</span><span class="p">))</span>

    <span class="n">ax_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;axon_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">ax_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;axon_0&quot;</span><span class="p">))</span>
    <span class="n">ax_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0 0.8 0&quot;</span><span class="p">))</span>

    <span class="n">soma_seg_group</span> <span class="o">=</span> <span class="n">get_seg_group_by_id</span><span class="p">(</span><span class="s2">&quot;soma_group&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
    <span class="n">soma_seg_group</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Include</span><span class="p">(</span><span class="n">segment_groups</span><span class="o">=</span><span class="s2">&quot;soma_0&quot;</span><span class="p">))</span>

    <span class="n">soma_seg_group</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Property</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0 0 0.8&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>We have now completed adding the morphological information to our cell.
Next, we proceed to our <a class="reference internal" href="Schemas/Cells.html#schema-biophysicalproperties"><span class="std std-ref">biophysical properties</span></a>, which are split into two:</p>
<ul class="simple">
<li><p>the <a class="reference internal" href="Schemas/Cells.html#schema-membraneproperties"><span class="std std-ref">membrane properties</span></a></p></li>
<li><p>the <a class="reference internal" href="Schemas/Cells.html#schema-intracellularproperties"><span class="std std-ref">intracellular properties</span></a></p></li>
</ul>
<p>We also use a few simple helper functions defined  in the <code class="docutils literal notranslate"><span class="pre">CellBuilder.py</span></code> module to add these to our cell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Other cell properties</span>
    <span class="n">set_init_memb_potential</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;-67mV&quot;</span><span class="p">)</span>
    <span class="n">set_resistivity</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;0.15 kohm_cm&quot;</span><span class="p">)</span>
    <span class="n">set_specific_capacitance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s2">&quot;1.3 uF_per_cm2&quot;</span><span class="p">)</span>

    <span class="c1"># channels</span>
    <span class="c1"># leak</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;leak_all&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;0.01 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;leak_chan&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/leak_chan.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-67mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;non_specific&quot;</span><span class="p">)</span>
    <span class="c1"># HCNolm_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;HCNolm_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;0.5 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;HCNolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/HCNolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-32.9mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;73.37 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;105.8 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Kdrfast_axon</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Kdrfast_axon&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;117.392 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Kdrfast&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_group&quot;</span><span class="p">)</span>
    <span class="c1"># KvAolm_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;KvAolm_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;4.95 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;KvAolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/KvAolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># KvAolm_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;KvAolm_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;2.8 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;KvAolm&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/KvAolm.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;-77mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_soma</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_soma&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;10.7 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;soma_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_dendrite</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_dendrite&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;23.4 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dendrite_group&quot;</span><span class="p">)</span>
    <span class="c1"># Nav_axon</span>
    <span class="n">add_channel_density</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">nml_cell_doc</span><span class="p">,</span>
                        <span class="n">cd_id</span><span class="o">=</span><span class="s2">&quot;Nav_axon&quot;</span><span class="p">,</span>
                        <span class="n">cond_density</span><span class="o">=</span><span class="s2">&quot;17.12 mS_per_cm2&quot;</span><span class="p">,</span>
                        <span class="n">ion_channel</span><span class="o">=</span><span class="s2">&quot;Nav&quot;</span><span class="p">,</span>
                        <span class="n">ion_chan_def_file</span><span class="o">=</span><span class="s2">&quot;olm-example/Nav.channel.nml&quot;</span><span class="p">,</span>
                        <span class="n">erev</span><span class="o">=</span><span class="s2">&quot;50mV&quot;</span><span class="p">,</span>
                        <span class="n">ion</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
                        <span class="n">group</span><span class="o">=</span><span class="s2">&quot;axon_group&quot;</span><span class="p">)</span>

    <span class="n">nml_cell_doc</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</pre></div>
</div>
<p>This completes the definition of our cell.
We write it to a NeuroML file, and validate it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">pynml</span><span class="o">.</span><span class="n">write_neuroml2_file</span><span class="p">(</span><span class="n">nml_cell_doc</span><span class="p">,</span> <span class="n">nml_cell_file</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting NeuroML file is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;neuroml</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.neuroml.org/schema/neuroml2&quot;</span>  <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.neuroml.org/schema/neuroml2 https://raw.github.com/NeuroML/NeuroML2/development/Schemas/NeuroML2/NeuroML_v2.2.xsd&quot;</span> <span class="na">id=</span><span class="s">&quot;oml_cell&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">href=</span><span class="s">&quot;olm-example/leak_chan.channel.nml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">href=</span><span class="s">&quot;olm-example/HCNolm.channel.nml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">href=</span><span class="s">&quot;olm-example/Kdrfast.channel.nml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">href=</span><span class="s">&quot;olm-example/KvAolm.channel.nml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">href=</span><span class="s">&quot;olm-example/Nav.channel.nml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;cell</span> <span class="na">id=</span><span class="s">&quot;olm&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;morphology</span> <span class="na">id=</span><span class="s">&quot;morphology&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg0_soma_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;proximal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;10.0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;1.000000e+01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;10.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;1&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg1_soma_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;parent</span> <span class="na">segment=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;2.000000e+01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;10.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;2&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg0_axon_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;parent</span> <span class="na">segment=</span><span class="s">&quot;0&quot;</span> <span class="na">fractionAlong=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;proximal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;1.5&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;-7.500000e+01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;1.5&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;3&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg1_axon_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;parent</span> <span class="na">segment=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;-1.500000e+02&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;1.5&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;4&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg0_dend_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;parent</span> <span class="na">segment=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;proximal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;2.000000e+01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;1.000000e+02&quot;</span> <span class="na">y=</span><span class="s">&quot;1.200000e+02&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;5&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg1_dend_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;parent</span> <span class="na">segment=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;1.770000e+02&quot;</span> <span class="na">y=</span><span class="s">&quot;1.970000e+02&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;6&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg0_dend_1&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;parent</span> <span class="na">segment=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;proximal</span> <span class="na">x=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">y=</span><span class="s">&quot;2.000000e+01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;-1.000000e+02&quot;</span> <span class="na">y=</span><span class="s">&quot;1.200000e+02&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segment</span> <span class="na">id=</span><span class="s">&quot;7&quot;</span> <span class="na">name=</span><span class="s">&quot;Seg1_dend_1&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;parent</span> <span class="na">segment=</span><span class="s">&quot;6&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;distal</span> <span class="na">x=</span><span class="s">&quot;-1.770000e+02&quot;</span> <span class="na">y=</span><span class="s">&quot;1.970000e+02&quot;</span> <span class="na">z=</span><span class="s">&quot;0.000000e+00&quot;</span> <span class="na">diameter=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segment&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">id=</span><span class="s">&quot;all&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;6&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;7&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">neuroLexId=</span><span class="s">&quot;GO:0043025&quot;</span> <span class="na">id=</span><span class="s">&quot;soma_group&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;notes&gt;</span>Default soma segment group for the cell<span class="nt">&lt;/notes&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">tag=</span><span class="s">&quot;color&quot;</span> <span class="na">value=</span><span class="s">&quot;0 0 0.8&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;include</span> <span class="na">segmentGroup=</span><span class="s">&quot;soma_0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">neuroLexId=</span><span class="s">&quot;GO:0030424&quot;</span> <span class="na">id=</span><span class="s">&quot;axon_group&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;notes&gt;</span>Default axon segment group for the cell<span class="nt">&lt;/notes&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">tag=</span><span class="s">&quot;color&quot;</span> <span class="na">value=</span><span class="s">&quot;0 0.8 0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;include</span> <span class="na">segmentGroup=</span><span class="s">&quot;axon_0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">neuroLexId=</span><span class="s">&quot;GO:0030425&quot;</span> <span class="na">id=</span><span class="s">&quot;dendrite_group&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;notes&gt;</span>Default dendrite segment group for the cell<span class="nt">&lt;/notes&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">tag=</span><span class="s">&quot;color&quot;</span> <span class="na">value=</span><span class="s">&quot;0.8 0 0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;6&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;7&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;include</span> <span class="na">segmentGroup=</span><span class="s">&quot;dend_0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;include</span> <span class="na">segmentGroup=</span><span class="s">&quot;dend_1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">neuroLexId=</span><span class="s">&quot;sao864921383&quot;</span> <span class="na">id=</span><span class="s">&quot;soma_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">neuroLexId=</span><span class="s">&quot;sao864921383&quot;</span> <span class="na">id=</span><span class="s">&quot;axon_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">neuroLexId=</span><span class="s">&quot;sao864921383&quot;</span> <span class="na">id=</span><span class="s">&quot;dend_0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
            <span class="nt">&lt;segmentGroup</span> <span class="na">neuroLexId=</span><span class="s">&quot;sao864921383&quot;</span> <span class="na">id=</span><span class="s">&quot;dend_1&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;6&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;member</span> <span class="na">segment=</span><span class="s">&quot;7&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/segmentGroup&gt;</span>
        <span class="nt">&lt;/morphology&gt;</span>
        <span class="nt">&lt;biophysicalProperties</span> <span class="na">id=</span><span class="s">&quot;biophys&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;membraneProperties&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;leak_all&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;leak_chan&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;0.01 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;-67mV&quot;</span> <span class="na">ion=</span><span class="s">&quot;non_specific&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;HCNolm_soma&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;HCNolm&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;0.5 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;-32.9mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;soma_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;h&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;Kdrfast_soma&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;Kdrfast&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;73.37 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;-77mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;soma_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;k&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;Kdrfast_dendrite&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;Kdrfast&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;105.8 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;-77mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;dendrite_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;k&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;Kdrfast_axon&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;Kdrfast&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;117.392 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;-77mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;axon_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;k&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;KvAolm_soma&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;KvAolm&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;4.95 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;-77mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;soma_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;k&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;KvAolm_dendrite&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;KvAolm&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;2.8 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;-77mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;dendrite_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;k&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;Nav_soma&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;Nav&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;10.7 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;50mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;soma_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;na&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;Nav_dendrite&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;Nav&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;23.4 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;50mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;dendrite_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;na&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;channelDensity</span> <span class="na">id=</span><span class="s">&quot;Nav_axon&quot;</span> <span class="na">ionChannel=</span><span class="s">&quot;Nav&quot;</span> <span class="na">condDensity=</span><span class="s">&quot;17.12 mS_per_cm2&quot;</span> <span class="na">erev=</span><span class="s">&quot;50mV&quot;</span> <span class="na">segmentGroup=</span><span class="s">&quot;axon_group&quot;</span> <span class="na">ion=</span><span class="s">&quot;na&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;specificCapacitance</span> <span class="na">value=</span><span class="s">&quot;1.3 uF_per_cm2&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;initMembPotential</span> <span class="na">value=</span><span class="s">&quot;-67mV&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/membraneProperties&gt;</span>
            <span class="nt">&lt;intracellularProperties&gt;</span>
                <span class="nt">&lt;resistivity</span> <span class="na">value=</span><span class="s">&quot;0.15 kohm_cm&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/intracellularProperties&gt;</span>
        <span class="nt">&lt;/biophysicalProperties&gt;</span>
    <span class="nt">&lt;/cell&gt;</span>
<span class="nt">&lt;/neuroml&gt;</span>
</pre></div>
</div>
<p>We can now already inspect our cell using the NeuroML tools:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pynml -png olm.cell.png</span>
<span class="go">...</span>
<span class="go">pyNeuroML &gt;&gt;&gt; Writing to: /home/asinha/Documents/02_Code/00_mine/2020-OSB/NeuroML-Documentation/source/Userdocs/NML2_examples/olm.cell.png</span>
</pre></div>
</div>
<p>This gives us a figure of the morphology of our cell:</p>
<div class="figure align-center" id="id3">
<img alt="Figure showing the morphology of the OLM cell generated from the NeuroML definition." src="../_images/olm.cell.png" />
<p class="caption"><span class="caption-number">Fig. 23 </span><span class="caption-text">Figure showing the morphology of the OLM cell generated from the NeuroML definition.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="declaring-the-network">
<h3>Declaring the network<a class="headerlink" href="#declaring-the-network" title="Permalink to this headline">¶</a></h3>
<p>We now use our cell in a network.
Similar to our previous example, we are going to only create a network with one cell, and an <a class="reference internal" href="Schemas/Networks.html#schema-explicitinput"><span class="std std-ref">explicit input</span></a> to the cell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_olm_network</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create the network</span>

<span class="sd">    :returns: name of network nml file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">net_doc</span> <span class="o">=</span> <span class="n">NeuroMLDocument</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;network&quot;</span><span class="p">,</span>
                              <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;OLM cell network&quot;</span><span class="p">)</span>
    <span class="n">net_doc_fn</span> <span class="o">=</span> <span class="s2">&quot;olm_example_net.nml&quot;</span>
    <span class="n">net_doc</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IncludeType</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="n">create_olm_cell</span><span class="p">()))</span>
    <span class="c1"># Create a population: convenient to create many cells of the same type</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;pop0&quot;</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;A population for our cell&quot;</span><span class="p">,</span>
                     <span class="n">component</span><span class="o">=</span><span class="s2">&quot;olm&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;populationList&quot;</span><span class="p">)</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Instance</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">Location</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)))</span>
    <span class="c1"># Input</span>
    <span class="n">pulsegen</span> <span class="o">=</span> <span class="n">PulseGenerator</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;pg_olm&quot;</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;Simple pulse generator&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="s2">&quot;100ms&quot;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="s2">&quot;100ms&quot;</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="s2">&quot;0.08nA&quot;</span><span class="p">)</span>

    <span class="n">exp_input</span> <span class="o">=</span> <span class="n">ExplicitInput</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;pop0[0]&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;pg_olm&quot;</span><span class="p">)</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;single_olm_cell_network&quot;</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;A network with a single population&quot;</span><span class="p">)</span>
    <span class="n">net_doc</span><span class="o">.</span><span class="n">pulse_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pulsegen</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">explicit_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp_input</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
    <span class="n">net_doc</span><span class="o">.</span><span class="n">networks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>

    <span class="n">pynml</span><span class="o">.</span><span class="n">write_neuroml2_file</span><span class="p">(</span><span class="n">nml2_doc</span><span class="o">=</span><span class="n">net_doc</span><span class="p">,</span> <span class="n">nml2_file_name</span><span class="o">=</span><span class="n">net_doc_fn</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">net_doc_fn</span>
</pre></div>
</div>
<p>We start in the same way, by creating a new NeuroML document and including our cell file into it.
We then create a <a class="reference internal" href="Schemas/Networks.html#schema-population"><span class="std std-ref">population</span></a> comprising of a single cell.
We create a <a class="reference internal" href="Schemas/Inputs.html#schema-pulsegenerator"><span class="std std-ref">pulse generator</span></a> as an <a class="reference internal" href="Schemas/Networks.html#schema-explicitinput"><span class="std std-ref">explicit input</span></a>, which targets our population.
Note that as the schema documentation for <code class="docutils literal notranslate"><span class="pre">ExplicitInput</span></code> notes, any current source (any component that <em>extends</em> <a class="reference internal" href="Schemas/Inputs.html#schema-basepointcurrent"><span class="std std-ref">basePointCurrent</span></a>) can be used as an <code class="docutils literal notranslate"><span class="pre">ExplicitInput</span></code>.</p>
<p>We add all of these to the <a class="reference internal" href="Schemas/Networks.html#schema-network"><span class="std std-ref">network</span></a> and save (and validate) our network file.
The NeuroML file generated is below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;neuroml</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.neuroml.org/schema/neuroml2&quot;</span>  <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.neuroml.org/schema/neuroml2 https://raw.github.com/NeuroML/NeuroML2/development/Schemas/NeuroML2/NeuroML_v2.2.xsd&quot;</span> <span class="na">id=</span><span class="s">&quot;network&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;notes&gt;</span>OLM cell network<span class="nt">&lt;/notes&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">href=</span><span class="s">&quot;olm.cell.nml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;pulseGenerator</span> <span class="na">id=</span><span class="s">&quot;pg_olm&quot;</span> <span class="na">delay=</span><span class="s">&quot;100ms&quot;</span> <span class="na">duration=</span><span class="s">&quot;100ms&quot;</span> <span class="na">amplitude=</span><span class="s">&quot;0.08nA&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;notes&gt;</span>Simple pulse generator<span class="nt">&lt;/notes&gt;</span>
    <span class="nt">&lt;/pulseGenerator&gt;</span>
    <span class="nt">&lt;network</span> <span class="na">id=</span><span class="s">&quot;single_olm_cell_network&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;population</span> <span class="na">id=</span><span class="s">&quot;pop0&quot;</span> <span class="na">component=</span><span class="s">&quot;olm&quot;</span> <span class="na">size=</span><span class="s">&quot;1&quot;</span> <span class="na">type=</span><span class="s">&quot;populationList&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;notes&gt;</span>A population for our cell<span class="nt">&lt;/notes&gt;</span>
            <span class="nt">&lt;instance</span> <span class="na">id=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;0.&quot;</span> <span class="na">y=</span><span class="s">&quot;0.&quot;</span> <span class="na">z=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/instance&gt;</span>
        <span class="nt">&lt;/population&gt;</span>
        <span class="nt">&lt;explicitInput</span> <span class="na">target=</span><span class="s">&quot;pop0[0]&quot;</span> <span class="na">input=</span><span class="s">&quot;pg_olm&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/network&gt;</span>
<span class="nt">&lt;/neuroml&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-generated-neuroml-model">
<h3>The generated NeuroML model<a class="headerlink" href="#the-generated-neuroml-model" title="Permalink to this headline">¶</a></h3>
<p>Before we look at simulating the model, we can inspect our model to check for correctness.
All our NeuroML files were validated when they were created already, so we do not need to run this step again.
However, if required, this can be easily done:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pynml -validate olm*nml</span>
</pre></div>
</div>
<p>Next, we can visualise our model using the information noted in the <a class="reference internal" href="VisualisingNeuroMLModels.html#userdocs-visualising-models"><span class="std std-ref">visualising NeuroML models</span></a> page (including the <code class="docutils literal notranslate"><span class="pre">-v</span></code> verbose option for more information on the cell):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pynml-summary olm_example_net.nml -v</span>
<span class="go">*******************************************************</span>
<span class="go">* NeuroMLDocument: network</span>
<span class="go">*</span>
<span class="go">*  ComponentType: [&#39;Bezaire_HCNolm_tau&#39;, &#39;Bezaire_Kdrfast_betaq&#39;, &#39;Bezaire_KvAolm_taub&#39;, &#39;Bezaire_Nav_alphah&#39;]</span>
<span class="go">*  IonChannel: [&#39;HCNolm&#39;, &#39;Kdrfast&#39;, &#39;KvAolm&#39;, &#39;Nav&#39;, &#39;leak_chan&#39;]</span>
<span class="go">*  PulseGenerator: [&#39;pg_olm&#39;]</span>
<span class="go">*</span>
<span class="go">*  Cell: olm</span>
<span class="go">*    &lt;Segment|0|Seg0_soma_0&gt;</span>
<span class="go">*      Parent segment: None (root segment)</span>
<span class="go">*      (0.0, 0.0, 0.0), diam 10.0um -&gt; (0.0, 10.0, 0.0), diam 10.0um; seg length: 10.0 um</span>
<span class="go">*      Surface area: 314.1592653589793 um2, volume: 785.3981633974482 um3</span>
<span class="go">*    &lt;Segment|1|Seg1_soma_0&gt;</span>
<span class="go">*      Parent segment: 0</span>
<span class="go">*      None -&gt; (0.0, 20.0, 0.0), diam 10.0um; seg length: 10.0 um</span>
<span class="go">*      Surface area: 314.1592653589793 um2, volume: 785.3981633974482 um3</span>
<span class="go">*    &lt;Segment|2|Seg0_axon_0&gt;</span>
<span class="go">*      Parent segment: 0</span>
<span class="go">*      (0.0, 0.0, 0.0), diam 1.5um -&gt; (0.0, -75.0, 0.0), diam 1.5um; seg length: 75.0 um</span>
<span class="go">*      Surface area: 353.4291735288517 um2, volume: 132.53594007331938 um3</span>
<span class="go">*    &lt;Segment|3|Seg1_axon_0&gt;</span>
<span class="go">*      Parent segment: 2</span>
<span class="go">*      None -&gt; (0.0, -150.0, 0.0), diam 1.5um; seg length: 75.0 um</span>
<span class="go">*      Surface area: 353.4291735288517 um2, volume: 132.53594007331938 um3</span>
<span class="go">*    &lt;Segment|4|Seg0_dend_0&gt;</span>
<span class="go">*      Parent segment: 1</span>
<span class="go">*      (0.0, 20.0, 0.0), diam 3.0um -&gt; (100.0, 120.0, 0.0), diam 3.0um; seg length: 141.4213562373095 um</span>
<span class="go">*      Surface area: 1332.8648814475098 um2, volume: 999.6486610856323 um3</span>
<span class="go">*    &lt;Segment|5|Seg1_dend_0&gt;</span>
<span class="go">*      Parent segment: 4</span>
<span class="go">*      None -&gt; (177.0, 197.0, 0.0), diam 3.0um; seg length: 108.89444430272832 um</span>
<span class="go">*      Surface area: 1026.3059587145826 um2, volume: 769.7294690359369 um3</span>
<span class="go">*    &lt;Segment|6|Seg0_dend_1&gt;</span>
<span class="go">*      Parent segment: 1</span>
<span class="go">*      (0.0, 20.0, 0.0), diam 3.0um -&gt; (-100.0, 120.0, 0.0), diam 3.0um; seg length: 141.4213562373095 um</span>
<span class="go">*      Surface area: 1332.8648814475098 um2, volume: 999.6486610856323 um3</span>
<span class="go">*    &lt;Segment|7|Seg1_dend_1&gt;</span>
<span class="go">*      Parent segment: 6</span>
<span class="go">*      None -&gt; (-177.0, 197.0, 0.0), diam 3.0um; seg length: 108.89444430272832 um</span>
<span class="go">*      Surface area: 1026.3059587145826 um2, volume: 769.7294690359369 um3</span>
<span class="go">*    Total length of 8 segments: 670.6316010800756 um; total area: 6053.518558099847 um2</span>
<span class="go">*</span>
<span class="go">*    SegmentGroup: all, 8 member(s),    0 included group(s);    contains 8 segments in total</span>
<span class="go">*    SegmentGroup: soma_group,  2 member(s),    1 included group(s);   contains 2 segments in total</span>
<span class="go">*    SegmentGroup: axon_group,  2 member(s),    1 included group(s);   contains 2 segments in total</span>
<span class="go">*    SegmentGroup: dendrite_group,      4 member(s),    2 included group(s);    contains 4 segments in total</span>
<span class="go">*    SegmentGroup: soma_0,      2 member(s),    0 included group(s);   contains 2 segments in total</span>
<span class="go">*    SegmentGroup: axon_0,      2 member(s),    0 included group(s);   contains 2 segments in total</span>
<span class="go">*    SegmentGroup: dend_0,      2 member(s),    0 included group(s);   contains 2 segments in total</span>
<span class="go">*    SegmentGroup: dend_1,      2 member(s),    0 included group(s);   contains 2 segments in total</span>
<span class="go">*</span>
<span class="go">*    Channel density: leak_all on all;  conductance of 0.01 mS_per_cm2 through ion chan leak_chan with ion non_specific, erev: -67mV</span>
<span class="go">*      Channel is on &lt;Segment|0|Seg0_soma_0&gt;,   total conductance: 0.1 S_per_m2 x 3.1415926535897934e-10 m2 = 3.1415926535897936e-11 S (31.41592653589794 pS)</span>
<span class="go">*      Channel is on &lt;Segment|1|Seg1_soma_0&gt;,   total conductance: 0.1 S_per_m2 x 3.1415926535897934e-10 m2 = 3.1415926535897936e-11 S (31.41592653589794 pS)</span>
<span class="go">*      Channel is on &lt;Segment|2|Seg0_axon_0&gt;,   total conductance: 0.1 S_per_m2 x 3.534291735288517e-10 m2 = 3.534291735288518e-11 S (35.34291735288518 pS)</span>
<span class="go">*      Channel is on &lt;Segment|3|Seg1_axon_0&gt;,   total conductance: 0.1 S_per_m2 x 3.534291735288517e-10 m2 = 3.534291735288518e-11 S (35.34291735288518 pS)</span>
<span class="go">*      Channel is on &lt;Segment|4|Seg0_dend_0&gt;,   total conductance: 0.1 S_per_m2 x 1.3328648814475097e-09 m2 = 1.3328648814475097e-10 S (133.28648814475096 pS)</span>
<span class="go">*      Channel is on &lt;Segment|5|Seg1_dend_0&gt;,   total conductance: 0.1 S_per_m2 x 1.0263059587145826e-09 m2 = 1.0263059587145826e-10 S (102.63059587145825 pS)</span>
<span class="go">*      Channel is on &lt;Segment|6|Seg0_dend_1&gt;,   total conductance: 0.1 S_per_m2 x 1.3328648814475097e-09 m2 = 1.3328648814475097e-10 S (133.28648814475096 pS)</span>
<span class="go">*      Channel is on &lt;Segment|7|Seg1_dend_1&gt;,   total conductance: 0.1 S_per_m2 x 1.0263059587145826e-09 m2 = 1.0263059587145826e-10 S (102.63059587145825 pS)</span>
<span class="go">*    Channel density: HCNolm_soma on soma_group;        conductance of 0.5 mS_per_cm2 through ion chan HCNolm with ion h, erev: -32.9mV</span>
<span class="go">*      Channel is on &lt;Segment|0|Seg0_soma_0&gt;,   total conductance: 5.0 S_per_m2 x 3.1415926535897934e-10 m2 = 1.5707963267948968e-09 S (1570.796326794897 pS)</span>
<span class="go">*      Channel is on &lt;Segment|1|Seg1_soma_0&gt;,   total conductance: 5.0 S_per_m2 x 3.1415926535897934e-10 m2 = 1.5707963267948968e-09 S (1570.796326794897 pS)</span>
<span class="go">*    Channel density: Kdrfast_soma on soma_group;       conductance of 73.37 mS_per_cm2 through ion chan Kdrfast with ion k, erev: -77mV</span>
<span class="go">*      Channel is on &lt;Segment|0|Seg0_soma_0&gt;,   total conductance: 733.7 S_per_m2 x 3.1415926535897934e-10 m2 = 2.3049865299388314e-07 S (230498.65299388315 pS)</span>
<span class="go">*      Channel is on &lt;Segment|1|Seg1_soma_0&gt;,   total conductance: 733.7 S_per_m2 x 3.1415926535897934e-10 m2 = 2.3049865299388314e-07 S (230498.65299388315 pS)</span>
<span class="go">*    Channel density: Kdrfast_dendrite on dendrite_group;       conductance of 105.8 mS_per_cm2 through ion chan Kdrfast with ion k, erev: -77mV</span>
<span class="go">*      Channel is on &lt;Segment|4|Seg0_dend_0&gt;,   total conductance: 1058.0 S_per_m2 x 1.3328648814475097e-09 m2 = 1.4101710445714652e-06 S (1410171.0445714653 pS)</span>
<span class="go">*      Channel is on &lt;Segment|5|Seg1_dend_0&gt;,   total conductance: 1058.0 S_per_m2 x 1.0263059587145826e-09 m2 = 1.0858317043200284e-06 S (1085831.7043200284 pS)</span>
<span class="go">*      Channel is on &lt;Segment|6|Seg0_dend_1&gt;,   total conductance: 1058.0 S_per_m2 x 1.3328648814475097e-09 m2 = 1.4101710445714652e-06 S (1410171.0445714653 pS)</span>
<span class="go">*      Channel is on &lt;Segment|7|Seg1_dend_1&gt;,   total conductance: 1058.0 S_per_m2 x 1.0263059587145826e-09 m2 = 1.0858317043200284e-06 S (1085831.7043200284 pS)</span>
<span class="go">*    Channel density: Kdrfast_axon on axon_group;       conductance of 117.392 mS_per_cm2 through ion chan Kdrfast with ion k, erev: -77mV</span>
<span class="go">*      Channel is on &lt;Segment|2|Seg0_axon_0&gt;,   total conductance: 1173.92 S_per_m2 x 3.534291735288517e-10 m2 = 4.1489757538898964e-07 S (414897.57538898964 pS)</span>
<span class="go">*      Channel is on &lt;Segment|3|Seg1_axon_0&gt;,   total conductance: 1173.92 S_per_m2 x 3.534291735288517e-10 m2 = 4.1489757538898964e-07 S (414897.57538898964 pS)</span>
<span class="go">*    Channel density: KvAolm_soma on soma_group;        conductance of 4.95 mS_per_cm2 through ion chan KvAolm with ion k, erev: -77mV</span>
<span class="go">*      Channel is on &lt;Segment|0|Seg0_soma_0&gt;,   total conductance: 49.5 S_per_m2 x 3.1415926535897934e-10 m2 = 1.5550883635269477e-08 S (15550.883635269476 pS)</span>
<span class="go">*      Channel is on &lt;Segment|1|Seg1_soma_0&gt;,   total conductance: 49.5 S_per_m2 x 3.1415926535897934e-10 m2 = 1.5550883635269477e-08 S (15550.883635269476 pS)</span>
<span class="go">*    Channel density: KvAolm_dendrite on dendrite_group;        conductance of 2.8 mS_per_cm2 through ion chan KvAolm with ion k, erev: -77mV</span>
<span class="go">*      Channel is on &lt;Segment|4|Seg0_dend_0&gt;,   total conductance: 28.0 S_per_m2 x 1.3328648814475097e-09 m2 = 3.7320216680530273e-08 S (37320.21668053028 pS)</span>
<span class="go">*      Channel is on &lt;Segment|5|Seg1_dend_0&gt;,   total conductance: 28.0 S_per_m2 x 1.0263059587145826e-09 m2 = 2.8736566844008313e-08 S (28736.566844008314 pS)</span>
<span class="go">*      Channel is on &lt;Segment|6|Seg0_dend_1&gt;,   total conductance: 28.0 S_per_m2 x 1.3328648814475097e-09 m2 = 3.7320216680530273e-08 S (37320.21668053028 pS)</span>
<span class="go">*      Channel is on &lt;Segment|7|Seg1_dend_1&gt;,   total conductance: 28.0 S_per_m2 x 1.0263059587145826e-09 m2 = 2.8736566844008313e-08 S (28736.566844008314 pS)</span>
<span class="go">*    Channel density: Nav_soma on soma_group;   conductance of 10.7 mS_per_cm2 through ion chan Nav with ion na, erev: 50mV</span>
<span class="go">*      Channel is on &lt;Segment|0|Seg0_soma_0&gt;,   total conductance: 107.0 S_per_m2 x 3.1415926535897934e-10 m2 = 3.361504139341079e-08 S (33615.04139341079 pS)</span>
<span class="go">*      Channel is on &lt;Segment|1|Seg1_soma_0&gt;,   total conductance: 107.0 S_per_m2 x 3.1415926535897934e-10 m2 = 3.361504139341079e-08 S (33615.04139341079 pS)</span>
<span class="go">*    Channel density: Nav_dendrite on dendrite_group;   conductance of 23.4 mS_per_cm2 through ion chan Nav with ion na, erev: 50mV</span>
<span class="go">*      Channel is on &lt;Segment|4|Seg0_dend_0&gt;,   total conductance: 234.0 S_per_m2 x 1.3328648814475097e-09 m2 = 3.118903822587173e-07 S (311890.3822587173 pS)</span>
<span class="go">*      Channel is on &lt;Segment|5|Seg1_dend_0&gt;,   total conductance: 234.0 S_per_m2 x 1.0263059587145826e-09 m2 = 2.401555943392123e-07 S (240155.59433921232 pS)</span>
<span class="go">*      Channel is on &lt;Segment|6|Seg0_dend_1&gt;,   total conductance: 234.0 S_per_m2 x 1.3328648814475097e-09 m2 = 3.118903822587173e-07 S (311890.3822587173 pS)</span>
<span class="go">*      Channel is on &lt;Segment|7|Seg1_dend_1&gt;,   total conductance: 234.0 S_per_m2 x 1.0263059587145826e-09 m2 = 2.401555943392123e-07 S (240155.59433921232 pS)</span>
<span class="go">*    Channel density: Nav_axon on axon_group;   conductance of 17.12 mS_per_cm2 through ion chan Nav with ion na, erev: 50mV</span>
<span class="go">*      Channel is on &lt;Segment|2|Seg0_axon_0&gt;,   total conductance: 171.20000000000002 S_per_m2 x 3.534291735288517e-10 m2 = 6.050707450813942e-08 S (60507.07450813943 pS)</span>
<span class="go">*      Channel is on &lt;Segment|3|Seg1_axon_0&gt;,   total conductance: 171.20000000000002 S_per_m2 x 3.534291735288517e-10 m2 = 6.050707450813942e-08 S (60507.07450813943 pS)</span>
<span class="go">*</span>
<span class="go">*    Specific capacitance on all: 1.3 uF_per_cm2</span>
<span class="go">*      Capacitance of &lt;Segment|0|Seg0_soma_0&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 3.1415926535897934e-10 m2 = 4.084070449666732e-12 F (4.084070449666732 pF)</span>
<span class="go">*      Capacitance of &lt;Segment|1|Seg1_soma_0&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 3.1415926535897934e-10 m2 = 4.084070449666732e-12 F (4.084070449666732 pF)</span>
<span class="go">*      Capacitance of &lt;Segment|2|Seg0_axon_0&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 3.534291735288517e-10 m2 = 4.594579255875073e-12 F (4.594579255875073 pF)</span>
<span class="go">*      Capacitance of &lt;Segment|3|Seg1_axon_0&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 3.534291735288517e-10 m2 = 4.594579255875073e-12 F (4.594579255875073 pF)</span>
<span class="go">*      Capacitance of &lt;Segment|4|Seg0_dend_0&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 1.3328648814475097e-09 m2 = 1.732724345881763e-11 F (17.32724345881763 pF)</span>
<span class="go">*      Capacitance of &lt;Segment|5|Seg1_dend_0&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 1.0263059587145826e-09 m2 = 1.3341977463289574e-11 F (13.341977463289574 pF)</span>
<span class="go">*      Capacitance of &lt;Segment|6|Seg0_dend_1&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 1.3328648814475097e-09 m2 = 1.732724345881763e-11 F (17.32724345881763 pF)</span>
<span class="go">*      Capacitance of &lt;Segment|7|Seg1_dend_1&gt;,  total capacitance: 0.013000000000000001 F_per_m2 x 1.0263059587145826e-09 m2 = 1.3341977463289574e-11 F (13.341977463289574 pF)</span>
<span class="go">*</span>
<span class="go">*  Network: single_olm_cell_network</span>
<span class="go">*</span>
<span class="go">*   1 cells in 1 populations</span>
<span class="go">*     Population: pop0 with 1 components of type olm</span>
<span class="go">*       Locations: [(0, 0, 0), ...]</span>
<span class="go">*</span>
<span class="go">*   0 connections in 0 projections</span>
<span class="go">*</span>
<span class="go">*   0 inputs in 0 input lists</span>
<span class="go">*</span>
<span class="go">*   1 explicit inputs (outside of input lists)</span>
<span class="go">*     Explicit Input of type pg_olm to pop0(cell 0), destination: unspecified</span>
<span class="go">*</span>
<span class="go">*******************************************************</span>
</pre></div>
</div>
<p>We can check the connectivity graph of the model:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pynml -graph 10 olm_example_net.nml</span>
</pre></div>
</div>
<p>which will give us this figure:</p>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../_images/single_olm_cell_network.gv.png"><img alt="Level 10 network graph generated by pynml" src="../_images/single_olm_cell_network.gv.png" style="width: 368.4px; height: 184.2px;" /></a>
<p class="caption"><span class="caption-number">Fig. 24 </span><span class="caption-text">Level 10 network graph generated by pynml</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="simulating-the-model">
<h2>Simulating the model<a class="headerlink" href="#simulating-the-model" title="Permalink to this headline">¶</a></h2>
<p>Now that we have declared and inspected our network model and all its components, we can proceed to simulate it.
We do this in the <code class="docutils literal notranslate"><span class="pre">main</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Main function</span>

<span class="sd">    Include the NeuroML model into a LEMS simulation file, run it, plot some</span>
<span class="sd">    data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Simulation bits</span>
    <span class="n">sim_id</span> <span class="o">=</span> <span class="s2">&quot;olm_example_sim&quot;</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">LEMSSimulation</span><span class="p">(</span><span class="n">sim_id</span><span class="o">=</span><span class="n">sim_id</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">simulation_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
    <span class="c1"># Include the NeuroML model file</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">include_neuroml2_file</span><span class="p">(</span><span class="n">create_olm_network</span><span class="p">())</span>
    <span class="c1"># Assign target for the simulation</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">assign_simulation_target</span><span class="p">(</span><span class="s2">&quot;single_olm_cell_network&quot;</span><span class="p">)</span>

    <span class="c1"># Recording information from the simulation</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">create_output_file</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span> <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0[0]/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_soma_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/0/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_soma_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/1/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_axon_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/2/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_axon_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/3/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_dend_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/4/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_dend_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/6/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_dend_1&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/5/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_dend_1&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/7/v&quot;</span><span class="p">)</span>
    <span class="c1"># Save LEMS simulation to file</span>
    <span class="n">sim_file</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">()</span>

    <span class="c1"># Run the simulation using the NEURON simulator</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">run_lems_with_jneuroml_neuron</span><span class="p">(</span><span class="n">sim_file</span><span class="p">,</span> <span class="n">max_memory</span><span class="o">=</span><span class="s2">&quot;2G&quot;</span><span class="p">,</span> <span class="n">nogui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Plot the data</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">sim_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we first create a <code class="docutils literal notranslate"><span class="pre">LEMSSimulation</span></code> instance and include our network NeuroML file in it.
We must inform LEMS what the target of the simulation is.
In our case, it’s the id of our network, <code class="docutils literal notranslate"><span class="pre">single_olm_cell_network</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">sim_id</span> <span class="o">=</span> <span class="s2">&quot;olm_example_sim&quot;</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">LEMSSimulation</span><span class="p">(</span><span class="n">sim_id</span><span class="o">=</span><span class="n">sim_id</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">simulation_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
    <span class="c1"># Include the NeuroML model file</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">include_neuroml2_file</span><span class="p">(</span><span class="n">create_olm_network</span><span class="p">())</span>
    <span class="c1"># Assign target for the simulation</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">assign_simulation_target</span><span class="p">(</span><span class="s2">&quot;single_olm_cell_network&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We also want to record some information, so we create an output file first with an <code class="docutils literal notranslate"><span class="pre">id</span></code> of <code class="docutils literal notranslate"><span class="pre">output0</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">simulation</span><span class="o">.</span><span class="n">create_output_file</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we can record any quantity that is exposed by NeuroML (any <code class="docutils literal notranslate"><span class="pre">exposure</span></code>).
Here, for example, we add columns for the membrane potentials <code class="docutils literal notranslate"><span class="pre">v</span></code> of the different segments of the <a class="reference internal" href="Schemas/Cells.html#schema-cell"><span class="std std-ref">cell</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_soma_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/0/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_soma_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/1/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_axon_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/2/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_axon_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/3/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_dend_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/4/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_dend_0&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/6/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg0_dend_1&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/5/v&quot;</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">add_column_to_output_file</span><span class="p">(</span><span class="s2">&quot;output0&quot;</span><span class="p">,</span>
                                         <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pop0_0_v_Seg1_dend_1&quot;</span><span class="p">,</span>
                                         <span class="n">quantity</span><span class="o">=</span><span class="s2">&quot;pop0/0/olm/7/v&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The path required to point to the <code class="docutils literal notranslate"><span class="pre">quantity</span></code> (exposure) to be recorded needs to be correctly provided.
Here, where we use a <a class="reference internal" href="Schemas/Networks.html#schema-populationlist"><span class="std std-ref">population list</span></a> that includes an <a class="reference internal" href="Schemas/Networks.html#schema-instance"><span class="std std-ref">instance</span></a> of the cell, it is: <code class="docutils literal notranslate"><span class="pre">population_id/instance_id/cell</span> <span class="pre">component</span> <span class="pre">type/segment</span> <span class="pre">id/exposure</span></code>. (See tickets <a class="reference external" href="https://github.com/NeuroML/Documentation/issues/15">15</a> and <a class="reference external" href="https://github.com/NeuroML/Documentation/issues/16">16</a>)</p>
<p>We then save the LEMS simulation file, and run our simulation with the <a class="reference internal" href="SimulatingNeuroMLModels.html#userdocs-simulating-models-neuron"><span class="std std-ref">NEURON</span></a> simulator (since the default <a class="reference internal" href="Software/jNeuroML.html#jneuroml"><span class="std std-ref">jNeuroML</span></a> simulator can only simulate single compartment cells).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Run the simulation using the NEURON simulator</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">run_lems_with_jneuroml_neuron</span><span class="p">(</span><span class="n">sim_file</span><span class="p">,</span> <span class="n">max_memory</span><span class="o">=</span><span class="s2">&quot;2G&quot;</span><span class="p">,</span> <span class="n">nogui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-the-recorded-variables">
<h2>Plotting the recorded variables<a class="headerlink" href="#plotting-the-recorded-variables" title="Permalink to this headline">¶</a></h2>
<p>To plot the variables that we recorded, we write a simple function that reads the data and uses the <code class="docutils literal notranslate"><span class="pre">generate_plot</span></code> utility function which generates the membrane potential graphs for different segments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">sim_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the sim data.</span>

<span class="sd">    Load the data from the file and plot the graph for the membrane potential</span>
<span class="sd">    using the pynml generate_plot utility function.</span>

<span class="sd">    :sim_id: ID of simulaton</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (soma seg 0)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg0_soma0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (soma seg 1)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg1_soma0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (axon seg 0)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg0_axon0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>
    <span class="n">pynml</span><span class="o">.</span><span class="n">generate_plot</span><span class="p">([</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">data_array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]],</span> <span class="s2">&quot;Membrane potential (axon seg 1)&quot;</span><span class="p">,</span> <span class="n">show_plot_already</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_figure_to</span><span class="o">=</span><span class="n">sim_id</span> <span class="o">+</span> <span class="s2">&quot;_seg1_axon0-v.png&quot;</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;membrane potential (V)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This concludes this example.
Here we have seen how to create, simulate, record, and visualise a multi-compartment neuron.
In the next section, you will find an interactive notebook where you can play with this example.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "NeuroML/Documentation",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Userdocs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="NML2_examples/HH_single_compartment.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Interactive single compartment HH example</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="NML2_examples/OLM.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interactive multi-compartment OLM cell example</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By NeuroML contributors<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>